<script type="text/javascript">
  window.onload=function(){
    imagenesCanvasArray=new Array();
    i=0;
    <%@trip.selecteds.order(:hour).each do |selected|%>
      imagenesCanvasArray[i]=generaImagenConCanvas('<%=image_path(selected.site.image.url)%>',true);
      i++;
    <%end%>    
  }
  
    
  function nuevaChinchetaDesdeForm(){
    selectedId=$("#selected_site_id").val();
    laUrl='<%= site_url('pongasuidaqui') %>'.replace('pongasuidaqui', selectedId).concat('.json');
    $.ajax({
      url: laUrl,
      dataType: 'json',
      data: null,
      success: function (data){
        latlongs[latlongs.length]=new google.maps.LatLng(data.latitude, data.longitude);
        siteNames[siteNames.length]=data.name;
        imagenesCanvasArray[imagenesCanvasArray.length]=generaImagenConCanvas('/system/images/'+data.id+'/original/'+data.image_file_name,false);
      }
    });
  }
</script>
  

<% if notice %>
  <p id="notice"><%= notice %></p>
<% end %>

<p>
  <b>Name:</b>
  <%= @trip.name %>
</p>

<p>
  <b>Description:</b>
  <%= simple_format @trip.description %>
</p>

<p>
  <b>Date:</b>
  <%= @trip.date %>
</p>


<div id="site_list">

  <h1>Sitios a visitar</h1>

  <%= render(@trip) %>

  <%= form_for(@selected, remote: true, :html => {:onsubmit => "nuevaChinchetaDesdeForm();"}) do |f| %>
  
    <%= f.number_field :trip_id, :value => @trip.id, :hidden => true %>
    <%= f.collection_select(:site_id, 
                            Site.all,
                            :id, 
                            :name) %>
    <%= f.select(:hour, Array.new(24, 0).fill {|i| [(i.to_s + 'H'), i]}) %>
    <%= f.submit "AÃ±adir sitio" %>
  <% end %>
</div>

<br />

<h2>Mapa:</h2> <br />

<div id="map_canvas"></div>

<%= link_to 'Edit', edit_trip_path(@trip) %> 
<%= link_to 'Back', trips_path %>

<p />



